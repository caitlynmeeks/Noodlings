<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>noodleMUSH Terminal</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.css" />
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #000000;
            overflow: hidden;
            font-family: 'Courier New', monospace;
        }
        #terminal-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            padding: 10px;
        }
        #terminal {
            width: 100%;
            height: 100%;
        }
        /* WYSE Amber theme for xterm */
        .xterm {
            background-color: #000000 !important;
        }
        .xterm-viewport {
            background-color: #000000 !important;
        }
        .xterm-screen {
            background-color: #000000 !important;
        }
    </style>
</head>
<body>
    <div id="terminal-container">
        <div id="terminal"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-web-links@0.9.0/lib/xterm-addon-web-links.js"></script>

    <script>
        // Create terminal with WYSE amber theme
        const term = new Terminal({
            cursorBlink: true,
            cursorStyle: 'block',
            fontSize: 16,
            fontFamily: '"Courier New", monospace',
            theme: {
                background: '#000000',
                foreground: '#ffb000',  // Amber
                cursor: '#ffd700',      // Bright amber
                cursorAccent: '#000000',
                selectionBackground: '#ffb000',
                selectionForeground: '#000000',
                black: '#000000',
                red: '#ff6600',
                green: '#00ff00',
                yellow: '#ffd700',      // Bright amber
                blue: '#0088ff',
                magenta: '#ff00ff',
                cyan: '#00ffff',
                white: '#ffb000',       // Amber
                brightBlack: '#666666',
                brightRed: '#ff8844',
                brightGreen: '#88ff88',
                brightYellow: '#ffd700',  // Bright amber
                brightBlue: '#4499ff',
                brightMagenta: '#ff88ff',
                brightCyan: '#88ffff',
                brightWhite: '#ffd700'    // Bright amber
            },
            allowProposedApi: true
        });

        // Add fit addon for responsive sizing
        const fitAddon = new FitAddon.FitAddon();
        term.loadAddon(fitAddon);

        // Add web links addon
        const webLinksAddon = new WebLinksAddon.WebLinksAddon();
        term.loadAddon(webLinksAddon);

        // Open terminal
        term.open(document.getElementById('terminal'));
        fitAddon.fit();

        // Handle window resize
        window.addEventListener('resize', () => {
            fitAddon.fit();
        });

        // Connect to WebSocket that bridges to Textual TUI
        const ws = new WebSocket('ws://localhost:8766');  // Different port for terminal bridge

        ws.onopen = () => {
            console.log('Connected to terminal bridge');
            // Send terminal size
            ws.send(JSON.stringify({
                type: 'resize',
                cols: term.cols,
                rows: term.rows
            }));
        };

        ws.onmessage = (event) => {
            // Write data from server to terminal
            term.write(event.data);
        };

        ws.onerror = (error) => {
            term.write('\r\n\x1b[31mConnection error!\x1b[0m\r\n');
            console.error('WebSocket error:', error);
        };

        ws.onclose = () => {
            term.write('\r\n\x1b[33mConnection closed\x1b[0m\r\n');
        };

        // Send keyboard input to server
        term.onData((data) => {
            if (ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({
                    type: 'input',
                    data: data
                }));
            }
        });

        // Handle terminal resize
        term.onResize(({ cols, rows }) => {
            if (ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({
                    type: 'resize',
                    cols: cols,
                    rows: rows
                }));
            }
        });

        // Focus terminal on load
        term.focus();
    </script>
</body>
</html>
